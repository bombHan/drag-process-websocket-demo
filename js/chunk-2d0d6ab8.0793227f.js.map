{"version":3,"sources":["webpack:///./src/views/websocket/index.vue?0b17","webpack:///src/views/websocket/index.vue","webpack:///./src/views/websocket/index.vue?f3ac","webpack:///./src/views/websocket/index.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","on","init","_v","attrs","connected","send","close","staticRenderFns","data","path","socket","timeout","timeoutObj","serverTimeoutObj","timeoutnum","mounted","beforeDestroy","methods","WebSocket","alert","onopen","open","onerror","error","onmessage","getMessage","onclose","console","log","e","reconnect","that","clearTimeout","setTimeout","reset","start","self","readyState","msg","component"],"mappings":"uHAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACA,EAAG,MAAM,CAACA,EAAG,WAAW,CAACE,GAAG,CAAC,MAAQN,EAAIO,OAAO,CAACP,EAAIQ,GAAG,iBAAiB,GAAGJ,EAAG,WAAW,CAACK,MAAM,CAAC,UAAYT,EAAIU,WAAWJ,GAAG,CAAC,MAAQN,EAAIW,OAAO,CAACX,EAAIQ,GAAG,SAASJ,EAAG,WAAW,CAACE,GAAG,CAAC,MAAQN,EAAIY,QAAQ,CAACZ,EAAIQ,GAAG,SAAS,IACnUK,EAAkB,GCUtB,GACEC,KADF,WAEI,MAAO,CACLC,KAAM,2BACNC,OAAQ,GACRN,WAAW,EACXO,QAAS,IACTC,WAAY,KACZC,iBAAkB,KAClBC,WAAY,OAGhBC,QAZF,aAcEC,cAdF,WAeIrB,KAAKW,SAEPW,QAAS,CACPhB,KADJ,WACA,WAC+B,qBAAdiB,UACTC,MAAM,mBAGNxB,KAAKe,OAAS,IAAIQ,UAAUvB,KAAKc,MAEjCd,KAAKe,OAAOU,OAASzB,KAAK0B,KAE1B1B,KAAKe,OAAOY,QAAU3B,KAAK4B,MAE3B5B,KAAKe,OAAOc,UAAY7B,KAAK8B,WAC7B9B,KAAKe,OAAOgB,QAAU,SAA9B,GACUC,QAAQC,IAAIC,GACZF,QAAQC,IAAI,MACZ,EAAV,gBAIIE,UApBJ,WAsBM,IAAIC,EAAOpC,KACPoC,EAAK3B,YAGT2B,EAAK3B,WAAY,EAEjB2B,EAAKjB,YAAckB,aAAaD,EAAKjB,YACrCiB,EAAKjB,WAAamB,YAAW,WAE3BF,EAAK9B,OACL8B,EAAK3B,WAAY,IACzB,OAEI8B,MAnCJ,WAqCM,IAAIH,EAAOpC,KAEXqC,aAAaD,EAAKnB,YAClBoB,aAAaD,EAAKlB,kBAElBkB,EAAKI,SAEPA,MA5CJ,WA8CM,IAAIC,EAAOzC,KACXyC,EAAKxB,YAAcoB,aAAaI,EAAKxB,YACrCwB,EAAKvB,kBAAoBmB,aAAaI,EAAKvB,kBAC3CuB,EAAKxB,WAAaqB,YAAW,WAEG,GAA1BG,EAAK1B,OAAO2B,WAEdD,EAAK1B,OAAOL,KAAK,cAGjB+B,EAAKN,YAEPM,EAAKvB,iBAAmBoB,YAAW,WAEjCG,EAAK1B,OAAOJ,UACtB,aACA,YAEIe,KAhEJ,WAiEM1B,KAAKS,WAAY,EACjBT,KAAKwC,QACLR,QAAQC,IAAI,sBAEdL,MArEJ,WAsEMI,QAAQC,IAAI,SAEdH,WAxEJ,SAwEA,GACME,QAAQC,IAAIU,GACZ3C,KAAKuC,SAEP7B,KA5EJ,WA6EMV,KAAKe,OAAOL,KAAK,CAAvB,OAEIC,MA/EJ,WAgFMX,KAAKe,QAAUf,KAAKe,OAAOJ,WC5Gia,I,YCO9biC,EAAY,eACd,EACA9C,EACAc,GACA,EACA,KACA,KACA,MAIa,aAAAgC,E","file":"js/chunk-2d0d6ab8.0793227f.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',[_c('a-button',{on:{\"click\":_vm.init}},[_vm._v(\"建立websocke\")])],1),_c('a-button',{attrs:{\"disabled\":!_vm.connected},on:{\"click\":_vm.send}},[_vm._v(\"发消息\")]),_c('a-button',{on:{\"click\":_vm.close}},[_vm._v(\"关闭\")])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div>\r\n    <div>\r\n      <a-button @click=\"init\">建立websocke</a-button>\r\n    </div>\r\n    <a-button @click=\"send\" :disabled=\"!connected\">发消息</a-button>\r\n    <a-button @click=\"close\">关闭</a-button>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      path: \"wss://echo.websocket.org\", //wss://api.baidu.com\r\n      socket: \"\",\r\n      connected: false,\r\n      timeout: 5000,\r\n      timeoutObj: null,\r\n      serverTimeoutObj: null,\r\n      timeoutnum: null\r\n    };\r\n  },\r\n  mounted() {\r\n  },\r\n  beforeDestroy() {\r\n    this.close();\r\n  },\r\n  methods: {\r\n    init() {\r\n      if (typeof WebSocket === \"undefined\") {\r\n        alert(\"您的浏览器不支持socket\");\r\n      } else {\r\n        // 实例化socket\r\n        this.socket = new WebSocket(this.path);\r\n        // 监听socket连接\r\n        this.socket.onopen = this.open;\r\n        // 监听socket错误信息\r\n        this.socket.onerror = this.error;\r\n        // 监听socket消息\r\n        this.socket.onmessage = this.getMessage;\r\n        this.socket.onclose = e => {\r\n          console.log(e); //监听关闭事件\r\n          console.log(\"关闭\");\r\n          this.connected = false;\r\n        };\r\n      }\r\n    },\r\n    reconnect() {\r\n      //重新连接\r\n      var that = this;\r\n      if (that.connected) {\r\n        return;\r\n      }\r\n      that.connected = true;\r\n      //没连接上会一直重连，设置延迟避免请求过多\r\n      that.timeoutnum && clearTimeout(that.timeoutnum);\r\n      that.timeoutnum = setTimeout(function() {\r\n        //新连接\r\n        that.init();\r\n        that.connected = false;\r\n      }, 5000);\r\n    },\r\n    reset() {\r\n      //重置心跳\r\n      var that = this;\r\n      //清除时间\r\n      clearTimeout(that.timeoutObj);\r\n      clearTimeout(that.serverTimeoutObj);\r\n      //重启心跳\r\n      that.start();\r\n    },\r\n    start() {\r\n      //开启心跳\r\n      var self = this;\r\n      self.timeoutObj && clearTimeout(self.timeoutObj);\r\n      self.serverTimeoutObj && clearTimeout(self.serverTimeoutObj);\r\n      self.timeoutObj = setTimeout(function() {\r\n        //这里发送一个心跳，后端收到后，返回一个心跳消息，\r\n        if (self.socket.readyState == 1) {\r\n          //如果连接正常\r\n          self.socket.send(\"heartCheck\");\r\n        } else {\r\n          //否则重连\r\n          self.reconnect();\r\n        }\r\n        self.serverTimeoutObj = setTimeout(function() {\r\n          //超时关闭\r\n          self.socket.close();\r\n        }, self.timeout);\r\n      }, self.timeout);\r\n    },\r\n    open() {\r\n      this.connected = true;\r\n      this.start()\r\n      console.log(\"socket连接成功,并且开始心跳\");\r\n    },\r\n    error() {\r\n      console.log(\"连接错误\");\r\n    },\r\n    getMessage(msg) {\r\n      console.log(msg);\r\n      this.reset();\r\n    },\r\n    send() {\r\n      this.socket.send({ a: 1 });\r\n    },\r\n    close() {\r\n      this.socket && this.socket.close(); //关闭websocket\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style>\r\n</style>","import mod from \"-!../../../node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/_thread-loader@2.1.3@thread-loader/dist/cjs.js!../../../node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js!../../../node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/_thread-loader@2.1.3@thread-loader/dist/cjs.js!../../../node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js!../../../node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=dfabaaf2&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/_vue-loader@15.9.3@vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}