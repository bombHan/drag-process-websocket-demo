(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0df439"],{"88be":function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t._v("\n  当前账号：\n  "),n("a-select",{staticStyle:{width:"200px"},model:{value:t.userId,callback:function(e){t.userId=e},expression:"userId"}},t._l(["user0","user1","user2"],(function(e){return n("a-select-option",{key:e,attrs:{value:e}},[t._v("\n      "+t._s(e)+"\n    ")])})),1),n("a-button",{attrs:{type:"primary"},on:{click:t.login}},[t._v("登录")]),n("a-button",{on:{click:t.logout}},[t._v("登出")]),n("br"),n("br"),t._m(0),n("div",{staticStyle:{display:"flex"}},[n("div",{staticStyle:{width:"50%",display:"flex"}},[n("div",{staticStyle:{background:"#ccc",width:"80px",overflow:"auto"}},t._l(t.privateList,(function(e,o){return n("div",{key:o,style:e.toAccount===t.targetId?"background: #fff; padding: 5px; border: 1px solid red;cursor: pointer;":"background: #fff; padding: 5px; border: 1px solid #ccc;cursor: pointer;",on:{click:function(n){return t.changePrivate(e)}}},[t._v("\n          "+t._s(e.toAccount)+"\n          "),n("a-badge",{staticStyle:{"margin-left":"10px"},style:e.unreadCount>0?"":"display:none",attrs:{status:"error"}})],1)})),0),n("div",{staticStyle:{flex:"1"}},[n("div",{staticStyle:{background:"#fff",height:"250px",overflow:"auto"},attrs:{id:"privateMessageList"}},[t._l(t.privateMessageList,(function(e,o){return[e.from===t.userId?n("div",{key:o,staticStyle:{display:"flex","flex-direction":"column",margin:"10px","align-items":"flex-end"}},[n("div",[t._v("\n                "+t._s(e.from)+"\n                "+t._s(t.moment(1e3*e.time).format("YYYY-MM-DD HH:mm:ss"))+"\n              ")]),n("div",{staticStyle:{"font-size":"12px"}},[t._v(t._s(e.payload.text))])]):n("div",{key:o,staticStyle:{margin:"10px"}},[n("div",[t._v(t._s(e.from))]),n("div",{staticStyle:{"font-size":"12px"}},[t._v(t._s(e.payload.text))])])]}))],2),n("a-textarea",{staticStyle:{resize:"none","border-radius":"unset"},attrs:{placeholder:"请输入",rows:4,autoSize:!1},model:{value:t.input,callback:function(e){t.input=e},expression:"input"}}),n("div",{staticStyle:{"margin-top":"20px"}},[n("a-button",{on:{click:t.send}},[t._v("发消息")])],1)],1)])])],1)},i=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{display:"flex"}},[n("div",{staticStyle:{width:"50%"}},[t._v("私聊")]),n("div",{staticStyle:{width:"50%"}},[t._v("多人")])])}],s=(n("6d57"),n("35f4")),a=n.n(s),c={name:"im",data:function(){return{moment:a.a,userId:"user0",targetId:"user1",privateList:[],privateMessageList:[],input:""}},created:function(){},destroyed:function(){this.logout()},watch:{privateMessageList:{handler:function(t,e){setTimeout((function(){var t=document.getElementById("privateMessageList");t.scrollTop=t.scrollHeight}),100)},deep:!0}},methods:{login:function(){var t=this,e=this.$genTestUserSig(this.userId);console.log(e);tim.login({userID:this.userId,userSig:e.userSig}).then((function(e){console.log(e),0===e.code&&t.watchMessage()})).catch((function(t){console.log(t)}))},logout:function(){tim.logout().then((function(t){console.log("登出成功",t.data)})).catch((function(t){console.warn("logout error:",t)}))},send:function(){var t=this;if(console.log("发送消息",this.input),this.input){var e=tim.createTextMessage({to:this.targetId,conversationType:TIM.TYPES.CONV_C2C,payload:{text:this.input}});this.input="",tim.sendMessage(e).then((function(e){console.log("发送成功消息",e),t.privateMessageList.push(e.data.message)})).catch((function(t){console.warn("sendMessage error:",t)}))}},changePrivate:function(t){this.targetId!==t.toAccount&&(this.targetId=t.toAccount,this.input="",this.getHistory(),tim.setMessageRead({conversationID:"C2C".concat(this.targetId)}))},getHistory:function(){var t=this;tim.getMessageList({conversationID:"C2C".concat(this.targetId),count:15}).then((function(e){0===e.code&&(t.privateMessageList=e.data.messageList,console.log("获取历史消息!!!!!!",e,t.privateMessageList))})).catch((function(t){console.log("获取历史消息报错！！！",t)}))},watchMessage:function(){var t=this;tim.on(TIM.EVENT.SDK_READY,(function(e){console.log(e),t.getHistory()})),tim.on(TIM.EVENT.MESSAGE_RECEIVED,(function(e){console.log("收到推送的单聊、群聊、群提示、群系统通知的新消息",e),e.data.forEach((function(e){e.from===t.targetId&&"C2C"===e.conversationType&&t.privateMessageList.push(e)})),tim.setMessageRead({conversationID:"C2C".concat(t.targetId)})})),tim.on(TIM.EVENT.MESSAGE_REVOKED,(function(t){console.log(t)})),tim.on(TIM.EVENT.MESSAGE_READ_BY_PEER,(function(t){console.log(t)})),tim.on(TIM.EVENT.CONVERSATION_LIST_UPDATED,(function(e){t.privateList=(e.data||[]).filter((function(t){return"C2C"===t.type})),console.log("最新的消息列表!!!!!",e,t.privateList)})),tim.on(TIM.EVENT.GROUP_LIST_UPDATED,(function(t){console.log(t)})),tim.on(TIM.EVENT.PROFILE_UPDATED,(function(t){console.log(t)})),tim.on(TIM.EVENT.BLACKLIST_UPDATED,(function(t){console.log(t)})),tim.on(TIM.EVENT.ERROR,(function(t){console.log(t)})),tim.on(TIM.EVENT.SDK_NOT_READY,(function(t){console.log(t)})),tim.on(TIM.EVENT.KICKED_OUT,(function(t){console.log(t)})),tim.on(TIM.EVENT.NET_STATE_CHANGE,(function(t){console.log(t)}))}}},r=c,l=n("9ca4"),u=Object(l["a"])(r,o,i,!1,null,"042826aa",null);e["default"]=u.exports}}]);
//# sourceMappingURL=chunk-2d0df439.e97e4b29.js.map